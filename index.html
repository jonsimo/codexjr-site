<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Codex Jr Updater</title>

  <style>
    :root{
      /* === EDIT THESE IF NEEDED === */
      --bg-src: url("assets/hero.webp");     /* <-- change if your background filename differs */
      --btn-src: url("assets/dl_button.png");
      --arrow-src: url("assets/8bitarrow.png");
      --cheat-src: url("assets/cheatcode.png");

      /* Background art native size (your PSD/export) */
      --art-w: 2000;
      --art-h: 1185;

      /* Anchor points in native pixels */
      --arrow-cx: 990;
      --arrow-cy: 580;     /* you gave this */
      --cheat-cx: 990;
      --cheat-cy: 690;     /* LOWER than before to match mockup (tweak if needed) */
      --sun-cx: 990;
      --sun-cy: 560;       /* subtle hover hint near sun (tweak if needed) */

      /* Animation timings */
      --arrows-total: 4000ms;
      --pause-after-arrows: 500ms;
      --cheat-fade: 3000ms;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* Full-bleed background */
    .bg {
      position: fixed;
      inset: 0;
      background-image: var(--bg-src);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transform: translateZ(0);
    }

    /* Click targets and overlays positioned using native-art coordinates but scaled with cover */
    .layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
    }

    /* We compute the cover-scale in JS and set these vars dynamically */
    .layer {
      --scale: 1;
      --off-x: 0px;
      --off-y: 0px;
    }

    /* Helper: place something at native pixel coords with cover scaling */
    .at {
      position: absolute;
      left: calc(var(--off-x) + (var(--x) * var(--scale) * 1px));
      top:  calc(var(--off-y) + (var(--y) * var(--scale) * 1px));
      transform: translate(-50%, -50%);
      pointer-events: auto;
    }

    /* Download button */
    .dl {
      width: min(780px, 68vw);
      max-width: 820px;
      aspect-ratio: 804 / 193; /* close enough; image will dictate anyway */
      background-image: var(--btn-src);
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: 0;
      padding: 0;
      cursor: pointer;
      background-color: transparent;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,0.55));
      transition: transform 120ms ease, filter 120ms ease, opacity 180ms ease;
      image-rendering: pixelated;
    }
    .dl:hover {
      transform: translate(-50%, -50%) scale(1.03);
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.7)) brightness(1.05);
    }
    .dl:active {
      transform: translate(-50%, -50%) scale(0.98);
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.6)) brightness(0.98);
    }

    /* Put download button just below the sun line like your comp */
    .dl.at {
      --x: 1000;  /* tweak if you want it dead-centre; this is “basically centre” on your art */
      --y: 760;   /* tweak vertical placement if needed */
    }

    /* Sun hotspot (invisible) + subtle hover hint */
    .sunHotspot.at {
      --x: var(--sun-cx);
      --y: var(--sun-cy);
      width: 220px;
      height: 140px;
      transform: translate(-50%, -50%);
      cursor: pointer;
      background: transparent;
      border: 0;
      padding: 0;
    }

    /* Subtle glow overlay (NO rings; just blurred radial wash) */
    .sunGlow {
      position: absolute;
      left: calc(var(--off-x) + (var(--sun-cx) * var(--scale) * 1px));
      top:  calc(var(--off-y) + (var(--sun-cy) * var(--scale) * 1px));
      width: calc(420px * var(--scale));
      height: calc(260px * var(--scale));
      transform: translate(-50%, -50%);
      pointer-events: none;
      opacity: 0;
      filter: blur(14px);
      transition: opacity 160ms ease;
      background: radial-gradient(closest-side,
        rgba(255, 220, 140, 0.32),
        rgba(255, 220, 140, 0.14) 35%,
        rgba(0,0,0,0) 72%);
      mix-blend-mode: screen;
    }
    .sunHintOn .sunGlow { opacity: 1; }

    /* Cheat overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease, background 220ms ease;
    }
    body.cheatOpen .overlay{
      background: rgba(0,0,0,0.62);
      opacity: 1;
      pointer-events: auto;
    }

    body.cheatOpen .dl { opacity: 0; pointer-events: none; }

    /* Arrows reveal container: centered on given point */
    .arrowsWrap.at{
      --x: var(--arrow-cx);
      --y: var(--arrow-cy);
      transform: translate(-50%,-50%);
      pointer-events: none;
    }
    .arrowsReveal {
      position: relative;
      overflow: hidden;
      height: auto;
      width: auto;
      display: inline-block;
      opacity: 0;
    }
    .arrowsImg{
      display: block;
      height: calc(70px * var(--scale)); /* tweak for match */
      width: auto;
      image-rendering: pixelated;
      transform: translateZ(0);
    }

    /* Animate: fade in + step-reveal across width over total time */
    body.cheatOpen .arrowsReveal{
      opacity: 1;
    }
    body.cheatOpen .arrowsReveal::after{
      content:"";
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.62);
      transform-origin: left center;
      animation: wipeSteps var(--arrows-total) steps(9,end) forwards;
      /* The ::after is a curtain that shrinks away in steps */
    }
    @keyframes wipeSteps{
      from { transform: scaleX(1); }
      to   { transform: scaleX(0); }
    }

    /* Cheat text image (your exact pixel layout) */
    .cheatWrap.at{
      --x: var(--cheat-cx);
      --y: var(--cheat-cy);
      pointer-events: none;
      opacity: 0;
    }
    .cheatImg{
      display:block;
      height: calc(110px * var(--scale)); /* tweak to match your mock */
      width: auto;
      image-rendering: pixelated;
    }

    /* Fade in cheat after arrows + pause */
    body.cheatOpen .cheatWrap{
      animation: cheatFade var(--cheat-fade) ease forwards;
      animation-delay: calc(var(--arrows-total) + var(--pause-after-arrows));
    }
    @keyframes cheatFade{
      from { opacity: 0; transform: translate(-50%,-50%) translateY(0px); }
      to   { opacity: 1; transform: translate(-50%,-50%) translateY(0px); }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="layer" id="layer">
    <!-- subtle hover hint -->
    <div class="sunGlow" id="sunGlow" aria-hidden="true"></div>

    <!-- Sun hotspot (hidden cheat trigger) -->
    <button class="sunHotspot at" id="sunHotspot" aria-label="Hidden"></button>

    <!-- Download button -->
    <button class="dl at" id="downloadBtn" aria-label="Download"></button>

    <!-- Cheat overlay content -->
    <div class="arrowsWrap at" id="arrowsWrap" aria-hidden="true">
      <div class="arrowsReveal" id="arrowsReveal">
        <img class="arrowsImg" src="assets/8bitarrow.png" alt="" />
      </div>
    </div>

    <div class="cheatWrap at" id="cheatWrap" aria-hidden="true">
      <img class="cheatImg" src="assets/cheatcode.png" alt="" />
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <script>
    // === DIRECT DOWNLOAD LINKS (no GitHub API; works even if pre-release) ===
    const TAG = "v.1.0.4";
    const ASSETS = {
      mac:     `https://github.com/jonsimo/codex-jr-updater/releases/download/${TAG}/CodexJr-Updater-mac-${TAG}.zip`,
      windows: `https://github.com/jonsimo/codex-jr-updater/releases/download/${TAG}/CodexJr-Updater-windows-${TAG}.zip`,
      linux:   `https://github.com/jonsimo/codex-jr-updater/releases/download/${TAG}/CodexJr-Updater-linux-${TAG}.zip` // only if you publish it
    };

    function detectOS(){
      // Prefer UA-CH when available
      const ua = navigator.userAgent || "";
      const plat = (navigator.platform || "").toLowerCase();

      if (navigator.userAgentData && navigator.userAgentData.platform) {
        const p = navigator.userAgentData.platform.toLowerCase();
        if (p.includes("mac")) return "mac";
        if (p.includes("win")) return "windows";
        if (p.includes("linux")) return "linux";
      }

      if (plat.includes("mac")) return "mac";
      if (plat.includes("win")) return "windows";
      if (plat.includes("linux")) return "linux";

      // Fallbacks
      if (/mac os|macintosh|mac_powerpc/i.test(ua)) return "mac";
      if (/windows/i.test(ua)) return "windows";
      if (/linux/i.test(ua)) return "linux";

      return "windows"; // sane default
    }

    // === COVER-SCALE MATH so our pixel coords land exactly on the background ===
    const layer = document.getElementById("layer");

    function updateCoverTransform(){
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const artW = Number(getComputedStyle(document.documentElement).getPropertyValue("--art-w")) || 2000;
      const artH = Number(getComputedStyle(document.documentElement).getPropertyValue("--art-h")) || 1185;

      // background-size: cover
      const scale = Math.max(vw / artW, vh / artH);
      const drawnW = artW * scale;
      const drawnH = artH * scale;

      const offX = (vw - drawnW) / 2;
      const offY = (vh - drawnH) / 2;

      layer.style.setProperty("--scale", scale.toString());
      layer.style.setProperty("--off-x", offX + "px");
      layer.style.setProperty("--off-y", offY + "px");
    }

    window.addEventListener("resize", updateCoverTransform);
    updateCoverTransform();

    // === Hover hint on sun (subtle glow, no ring) ===
    const sunHotspot = document.getElementById("sunHotspot");
    sunHotspot.addEventListener("mouseenter", () => document.body.classList.add("sunHintOn"));
    sunHotspot.addEventListener("mouseleave", () => document.body.classList.remove("sunHintOn"));

    // === Cheat overlay open/close ===
    const overlay = document.getElementById("overlay");
    const arrowsReveal = document.getElementById("arrowsReveal");
    const cheatWrap = document.getElementById("cheatWrap");

    function openCheat(){
      // restart animations cleanly
      document.body.classList.remove("cheatOpen");
      void document.body.offsetWidth; // reflow
      // reset cheat fade animation by toggling node
      cheatWrap.style.animation = "none";
      void cheatWrap.offsetWidth;
      cheatWrap.style.animation = "";

      document.body.classList.add("cheatOpen");
    }

    function closeCheat(){
      document.body.classList.remove("cheatOpen");
    }

    sunHotspot.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      openCheat();
    });

    overlay.addEventListener("click", closeCheat);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeCheat();
    });

    // === Download button ===
    const downloadBtn = document.getElementById("downloadBtn");
    downloadBtn.addEventListener("click", (e) => {
      e.preventDefault();
      const os = detectOS();
      const url = ASSETS[os] || ASSETS.windows;
      // If you don't ship linux yet, it will still fall back to windows unless you remove linux above.
      window.location.href = url;
    });
  </script>
</body>
</html>
