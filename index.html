<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Codex Jr Updater</title>

  <style>
    :root{
      --jr-yellow:#ffd54a;

      /* ✅ SUN ANCHOR (single source of truth)
         If you ever need a micro-nudge, do it here only.
         Start values are based on your earlier 990x580 in a 2000x1185 comp (~49.5%, ~48.9%).
      */
      --sun-x:49.5%;
      --sun-y:48.9%;
    }

    html,body{
      width:100%;
      height:100%;
      margin:0;
      background:#000;
      overflow:hidden;
    }

    body{
      background-image:url("assets/codexjr-hero-1000.webp");
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    @media (min-width:900px){
      body{ background-image:url("assets/codexjr-hero-2000.webp"); }
    }

    .vignette{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      background:radial-gradient(ellipse at center, rgba(0,0,0,0.00) 30%, rgba(0,0,0,0.62) 100%);
    }

    /* ---------------- Download Button ---------------- */
    .dl-wrap{
      position:fixed;
      left:50%;
      top:68%;
      transform:translate(-50%,-50%);
      z-index:6;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .dl-wrap img{
      width:clamp(240px, 32vw, 460px);
      height:auto;
      image-rendering:pixelated;
      filter:drop-shadow(0 12px 28px rgba(0,0,0,0.60));
      transition:transform 120ms cubic-bezier(.2,.8,.2,1), filter 120ms cubic-bezier(.2,.8,.2,1), opacity 120ms ease;
      display:block;
    }
    @keyframes glowPulse{
      0%   { filter:drop-shadow(0 0 8px rgba(255,213,74,0.55)) drop-shadow(0 12px 28px rgba(0,0,0,0.60)); }
      50%  { filter:drop-shadow(0 0 16px rgba(255,213,74,0.78)) drop-shadow(0 14px 32px rgba(0,0,0,0.72)); }
      100% { filter:drop-shadow(0 0 8px rgba(255,213,74,0.55)) drop-shadow(0 12px 28px rgba(0,0,0,0.60)); }
    }
    .dl-wrap:hover img{
      transform:translateY(-3px);
      animation:glowPulse 1.25s ease-in-out infinite;
    }
    .dl-wrap:active img{
      transform:translateY(2px);
      animation:none;
    }
    body.cheat-open .dl-wrap{ opacity:0; pointer-events:none; }

    /* ---------------- Secret Sun Hint ---------------- */
    #sunHitbox{
      position:fixed;
      left:var(--sun-x);
      top:var(--sun-y);
      transform:translate(-50%,-50%);
      width:150px;
      height:150px;
      border-radius:999px;
      opacity:0;
      cursor:pointer;
      z-index:7;
      -webkit-tap-highlight-color:transparent;
    }

    /* subtle hover hint (no ring artifact): just a soft bloom */
    #sunGlow{
      position:fixed;
      left:var(--sun-x);
      top:var(--sun-y);
      transform:translate(-50%,-50%);
      width:240px;
      height:240px;
      border-radius:50%;
      pointer-events:none;
      z-index:3;
      opacity:0;

      /* no hard edges / no ring */
      background:radial-gradient(circle,
        rgba(255,213,74,0.00) 0%,
        rgba(255,213,74,0.12) 42%,
        rgba(255,213,74,0.00) 74%
      );
      filter:blur(1px) drop-shadow(0 0 12px rgba(255,213,74,0.14));
      transition:opacity 160ms ease, transform 160ms ease, filter 160ms ease;
    }
    @keyframes sunBreatheSoft{
      0%   { filter:blur(1px) drop-shadow(0 0 12px rgba(255,213,74,0.14)); }
      50%  { filter:blur(1px) drop-shadow(0 0 18px rgba(255,213,74,0.22)); }
      100% { filter:blur(1px) drop-shadow(0 0 12px rgba(255,213,74,0.14)); }
    }
    #sunHitbox:hover + #sunGlow{
      opacity:1;
      transform:translate(-50%,-50%) scale(1.02);
      animation:sunBreatheSoft 1.7s ease-in-out infinite;
    }

    /* ---------------- Cheat Overlay ---------------- */
    #cheatOverlay{
      position:fixed;
      inset:0;
      z-index:50;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.62);
      cursor:pointer;
    }
    #cheatOverlay.show{ display:flex; }

    /* ✅ Anchor cheat content to the SAME SUN position as the hitbox */
    .cheatBlock{
      position:fixed;
      left:var(--sun-x);
      top:var(--sun-y);
      transform:translate(-50%,-50%);
      text-align:center;
      user-select:none;
      z-index:55;
      pointer-events:none; /* clicking overlay closes */
    }

    /* Arrow row: use a fixed grid so the true center is the 5th cell */
    .arrowGrid{
      display:grid;
      grid-template-columns:repeat(9, var(--cell));
      column-gap:var(--gap);
      align-items:center;
      justify-content:center;
      margin:0 auto;
      width:max-content;

      /* responsive but stable */
      --cell:clamp(40px, 3.6vw, 64px);
      --gap:clamp(10px, 1.25vw, 22px);
      margin-bottom:clamp(12px, 1.25vw, 18px);
    }
    .cell{
      width:var(--cell);
      height:var(--cell);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .arrow{
      width:100%;
      height:100%;
      object-fit:contain;
      image-rendering:pixelated;
      opacity:0;
      transition:opacity 450ms linear;
      filter:drop-shadow(0 2px 0 rgba(0,0,0,0.9));
      transform-origin:center center;
      display:block;
    }
    .arrow.on{ opacity:1; }

    /* rotations */
    .rot90{ transform:rotate(90deg); }
    .rot180{ transform:rotate(180deg); }
    .rot270{ transform:rotate(270deg); }

    /* Cheatcode image: centered to sun, fades in 3000ms */
    #cheatImg{
      width:clamp(380px, 42vw, 720px);
      height:auto;
      image-rendering:pixelated;
      opacity:0;
      transition:opacity 3000ms ease;
      filter:drop-shadow(0 2px 0 rgba(0,0,0,0.9));
      display:block;
      margin:0 auto;
    }
    #cheatImg.on{ opacity:1; }
  </style>
</head>

<body>
  <div class="vignette"></div>

  <!-- Secret sun hotspot + hover hint -->
  <div id="sunHitbox" aria-label="secret"></div>
  <div id="sunGlow"></div>

  <!-- Download button -->
  <a href="#" id="downloadBtn" class="dl-wrap" aria-label="download">
    <img src="assets/dl_button.png" alt="Download Codex Jr Updater">
  </a>

  <!-- Cheat overlay -->
  <div id="cheatOverlay" aria-hidden="true">
    <div class="cheatBlock" id="cheatBlock">
      <div class="arrowGrid" id="arrowGrid"></div>
      <img id="cheatImg" src="assets/cheatcode.png" alt="pixel pond cheat code">
    </div>
  </div>

  <script>
    /* ---------------- Downloads (direct asset links by tag) ---------------- */
    const OWNER = "jonsimo";
    const REPO  = "codex-jr-updater";
    const TAG   = "v.1.0.4";

    const ASSET = {
      mac: `CodexJr-Updater-mac-${TAG}.zip`,
      win: `CodexJr-Updater-windows-${TAG}.zip`,
    };

    function detectOS(){
      const ua = navigator.userAgent.toLowerCase();
      if ((ua.includes("mac os x") || ua.includes("macintosh")) && !ua.includes("iphone") && !ua.includes("ipad")) return "mac";
      if (ua.includes("windows")) return "win";
      if (ua.includes("linux")) return "lin";
      return "unknown";
    }

    function directAssetUrl(fileName){
      return `https://github.com/${OWNER}/${REPO}/releases/download/${TAG}/${encodeURIComponent(fileName)}`;
    }

    function startDownload(){
      const os = detectOS();
      if (os === "mac") { location.href = directAssetUrl(ASSET.mac); return; }
      if (os === "win") { location.href = directAssetUrl(ASSET.win); return; }
      location.href = `https://github.com/${OWNER}/${REPO}/releases/tag/${TAG}`;
    }

    document.getElementById("downloadBtn").addEventListener("click", (e) => {
      e.preventDefault();
      startDownload();
    });

    /* ---------------- Cheat overlay animation ---------------- */
    const sunHitbox = document.getElementById("sunHitbox");
    const overlay   = document.getElementById("cheatOverlay");
    const cheatImg  = document.getElementById("cheatImg");
    const arrowGrid = document.getElementById("arrowGrid");

    // Sequence: ↑ ↑ ↑ ← ↓ → ↑ ↑ ↑
    const SEQ = ["up","up","up","left","down","right","up","up","up"];

    // Timing: arrows over 4000ms total, 500ms pause, cheatImg fades in 3000ms (CSS)
    const ARROW_TOTAL_MS = 4000;
    const PAUSE_MS = 500;
    const STEP_MS = Math.round(ARROW_TOTAL_MS / (SEQ.length - 1));

    let timers = [];
    function clearTimers(){ timers.forEach(t => clearTimeout(t)); timers = []; }

    function buildArrows(){
      arrowGrid.innerHTML = "";
      for (const dir of SEQ) {
        const cell = document.createElement("div");
        cell.className = "cell";

        const img = document.createElement("img");
        img.src = "assets/8bitarrow.png";
        img.className = "arrow";
        img.alt = dir;

        if (dir === "right") img.classList.add("rot90");
        if (dir === "down")  img.classList.add("rot180");
        if (dir === "left")  img.classList.add("rot270");

        cell.appendChild(img);
        arrowGrid.appendChild(cell);
      }
    }

    function resetCheat(){
      clearTimers();
      buildArrows();
      cheatImg.classList.remove("on");
      Array.from(arrowGrid.querySelectorAll(".arrow")).forEach(a => a.classList.remove("on"));
    }

    function openCheat(){
      resetCheat();
      document.body.classList.add("cheat-open");
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");

      const arrows = Array.from(arrowGrid.querySelectorAll(".arrow"));
      arrows.forEach((el, i) => {
        timers.push(setTimeout(() => el.classList.add("on"), i * STEP_MS));
      });

      const totalArrowTime = (SEQ.length - 1) * STEP_MS;
      timers.push(setTimeout(() => cheatImg.classList.add("on"), totalArrowTime + PAUSE_MS));
    }

    function closeCheat(){
      clearTimers();
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      document.body.classList.remove("cheat-open");
      resetCheat();
    }

    sunHitbox.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      openCheat();
    });

    overlay.addEventListener("click", () => closeCheat());
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && overlay.classList.contains("show")) closeCheat();
    });

    buildArrows();
  </script>
</body>
</html>
