<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Codex Jr Updater</title>

  <style>
    :root{ --jr-yellow:#ffd54a; }

    html,body{
      width:100%;
      height:100%;
      margin:0;
      background:#000;
      overflow:hidden;
    }

    /* Background */
    body{
      background-image:url("assets/codexjr-hero-1000.webp");
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    @media (min-width:900px){
      body{ background-image:url("assets/codexjr-hero-2000.webp"); }
    }

    .vignette{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      background:radial-gradient(ellipse at center, rgba(0,0,0,0.00) 30%, rgba(0,0,0,0.62) 100%);
    }

    /* ---------------- Download Button ---------------- */
    .dl-wrap{
      position:fixed;
      left:50%;
      top:68%;
      transform:translate(-50%,-50%);
      z-index:6;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .dl-wrap img{
      width:clamp(240px, 32vw, 460px);
      height:auto;
      image-rendering:pixelated;
      filter:drop-shadow(0 12px 28px rgba(0,0,0,0.60));
      transition:transform 120ms cubic-bezier(.2,.8,.2,1), filter 120ms cubic-bezier(.2,.8,.2,1), opacity 120ms ease;
    }
    @keyframes glowPulse{
      0%   { filter:drop-shadow(0 0 8px rgba(255,213,74,0.55)) drop-shadow(0 12px 28px rgba(0,0,0,0.60)); }
      50%  { filter:drop-shadow(0 0 16px rgba(255,213,74,0.75)) drop-shadow(0 14px 32px rgba(0,0,0,0.70)); }
      100% { filter:drop-shadow(0 0 8px rgba(255,213,74,0.55)) drop-shadow(0 12px 28px rgba(0,0,0,0.60)); }
    }
    .dl-wrap:hover img{
      transform:translate(-50%,-50%) translateY(-3px);
      animation:glowPulse 1.25s ease-in-out infinite;
    }
    .dl-wrap:active img{
      transform:translate(-50%,-50%) translateY(2px);
      animation:none;
    }

    /* keep transform simple: wrap handles translate */
    .dl-wrap{ transform:translate(-50%,-50%); }
    .dl-wrap:hover img, .dl-wrap:active img{ transform:translateY(var(--btnY,0px)); }
    .dl-wrap:hover img{ --btnY:-3px; }
    .dl-wrap:active img{ --btnY:2px; }

    body.cheat-open .dl-wrap{ opacity:0; pointer-events:none; }

    /* ---------------- Secret Sun Hint (subtle / no ring artifact) ---------------- */
    #sunHitbox{
      position:fixed;
      left:50%;
      top:52%;
      transform:translate(-50%,-50%);
      width:140px;
      height:140px;
      border-radius:999px;
      opacity:0;
      cursor:pointer;
      z-index:7;
      -webkit-tap-highlight-color:transparent;
    }
    #sunGlow{
      position:fixed;
      left:50%;
      top:52%;
      transform:translate(-50%,-50%);
      width:240px;
      height:240px;
      border-radius:50%;
      pointer-events:none;
      z-index:3;
      opacity:0;
      background:radial-gradient(circle,
        rgba(255,213,74,0.00) 0%,
        rgba(255,213,74,0.10) 26%,
        rgba(255,213,74,0.06) 44%,
        rgba(255,213,74,0.00) 72%
      );
      filter:drop-shadow(0 0 10px rgba(255,213,74,0.10));
      transition:opacity 180ms ease, transform 180ms ease, filter 180ms ease;
    }
    @keyframes sunBreatheSoft{
      0%   { filter:drop-shadow(0 0 10px rgba(255,213,74,0.10)); }
      50%  { filter:drop-shadow(0 0 16px rgba(255,213,74,0.14)); }
      100% { filter:drop-shadow(0 0 10px rgba(255,213,74,0.10)); }
    }
    #sunHitbox:hover + #sunGlow{
      opacity:1;
      transform:translate(-50%,-50%) scale(1.02);
      animation:sunBreatheSoft 1.8s ease-in-out infinite;
    }

    /* ---------------- Cheat Overlay ---------------- */
    #cheatOverlay{
      position:fixed;
      inset:0;
      z-index:50;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.62);
      cursor:pointer;
    }
    #cheatOverlay.show{ display:flex; }

    /* PSD stage coordinates: 2000 x 1185 */
    .cheatStage{
      width:2000px;
      height:1185px;
      position:relative;
      transform-origin:center center;
      user-select:none;
    }

    /* Exact center point you gave: 990x580 */
    .cheatBlock{
      position:absolute;
      left:990px;
      top:580px;
      transform:translate(-50%,-50%);
      text-align:center;
    }

    /* Arrow row (centered as a LOCKED group) */
    .arrowRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:22px;               /* tweak if needed to match PSD spacing */
      margin-bottom:18px;     /* tweak to match PSD vertical spacing */
    }
    .arrow{
      width:64px;             /* tweak to match your arrow PNG size in PSD */
      height:auto;
      image-rendering:pixelated;
      opacity:0;
      transition:opacity 450ms linear;
      filter:drop-shadow(0 2px 0 rgba(0,0,0,0.9));
    }
    .arrow.on{ opacity:1; }
    .rot90{ transform:rotate(90deg); }
    .rot180{ transform:rotate(180deg); }
    .rot270{ transform:rotate(270deg); }

    /* Cheat text image (exact from PSD) */
    .cheatImg{
      width:520px;            /* tweak to match PSD */
      height:auto;
      image-rendering:pixelated;
      opacity:0;
      transition:opacity 3000ms ease; /* your requested 3000ms */
      filter:drop-shadow(0 2px 0 rgba(0,0,0,0.9));
    }
    .cheatImg.on{ opacity:1; }
  </style>
</head>

<body>
  <div class="vignette"></div>

  <!-- Secret sun hotspot + hover hint -->
  <div id="sunHitbox" aria-label="secret"></div>
  <div id="sunGlow"></div>

  <!-- Download button -->
  <a href="#" id="downloadBtn" class="dl-wrap" aria-label="download">
    <img src="assets/dl_button.png" alt="Download Codex Jr Updater">
  </a>

  <!-- Cheat overlay -->
  <div id="cheatOverlay" aria-hidden="true">
    <div class="cheatStage" id="cheatStage">
      <div class="cheatBlock">
        <div class="arrowRow" id="arrowRow"></div>
        <img class="cheatImg" id="cheatImg" src="assets/cheatcode.png" alt="pixel pond cheat code">
      </div>
    </div>
  </div>

  <script>
    /* ---------------- Downloads (DIRECT asset links by tag) ----------------
       This avoids GitHub API + prerelease “latest” issues completely.
    */
    const OWNER = "jonsimo";
    const REPO  = "codex-jr-updater";
    const TAG   = "v.1.0.4"; // your release tag

    // Your exact asset names:
    const ASSET = {
      mac: `CodexJr-Updater-mac-${TAG}.zip`,
      win: `CodexJr-Updater-windows-${TAG}.zip`,
      // If you later add linux, match your naming here:
      // lin: `CodexJr-Updater-linux-${TAG}.zip`,
    };

    function detectOS(){
      const ua = navigator.userAgent.toLowerCase();
      if ((ua.includes("mac os x") || ua.includes("macintosh")) && !ua.includes("iphone") && !ua.includes("ipad")) return "mac";
      if (ua.includes("windows")) return "win";
      if (ua.includes("linux")) return "lin";
      return "unknown";
    }

    function directAssetUrl(fileName){
      // Direct download endpoint (forces a download instead of a releases page)
      return `https://github.com/${OWNER}/${REPO}/releases/download/${TAG}/${encodeURIComponent(fileName)}`;
    }

    function startDownload(){
      const os = detectOS();

      if (os === "mac") {
        location.href = directAssetUrl(ASSET.mac);
        return;
      }
      if (os === "win") {
        location.href = directAssetUrl(ASSET.win);
        return;
      }

      // Unknown / linux fallback: open the tag page
      location.href = `https://github.com/${OWNER}/${REPO}/releases/tag/${TAG}`;
    }

    document.getElementById("downloadBtn").addEventListener("click", (e) => {
      e.preventDefault();
      startDownload();
    });

    /* ---------------- Cheat overlay animation ---------------- */
    const sunHitbox = document.getElementById("sunHitbox");
    const overlay   = document.getElementById("cheatOverlay");
    const cheatImg  = document.getElementById("cheatImg");
    const stage     = document.getElementById("cheatStage");
    const arrowRow  = document.getElementById("arrowRow");

    // Sequence: ↑ ↑ ↑ ← ↓ → ↑ ↑ ↑
    // We'll reuse ONE PNG and rotate it.
    const SEQ = ["up","up","up","left","down","right","up","up","up"];

    // Timing: 4000ms total arrows, then 500ms pause, then cheat image fades (3000ms via CSS)
    const ARROW_TOTAL_MS = 4000;
    const PAUSE_MS = 500;
    const STEP_MS = Math.round(ARROW_TOTAL_MS / (SEQ.length - 1)); // evenly spread

    let timers = [];
    function clearTimers(){ timers.forEach(t => clearTimeout(t)); timers = []; }

    function fitStage(){
      const vw = window.innerWidth, vh = window.innerHeight;
      const s = Math.min(vw / 2000, vh / 1185);
      stage.style.transform = `scale(${s})`;
    }

    function buildArrows(){
      arrowRow.innerHTML = "";
      for (const dir of SEQ) {
        const img = document.createElement("img");
        img.src = "assets/8bitarrow.png";
        img.className = "arrow";
        img.alt = dir;

        if (dir === "right") img.classList.add("rot90");
        if (dir === "down")  img.classList.add("rot180");
        if (dir === "left")  img.classList.add("rot270");

        arrowRow.appendChild(img);
      }
    }

    function resetCheat(){
      clearTimers();
      buildArrows();
      cheatImg.classList.remove("on");
      Array.from(arrowRow.children).forEach(a => a.classList.remove("on"));
    }

    function openCheat(){
      resetCheat();
      fitStage();

      document.body.classList.add("cheat-open");
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");

      const arrows = Array.from(arrowRow.children);

      arrows.forEach((el, i) => {
        timers.push(setTimeout(() => el.classList.add("on"), i * STEP_MS));
      });

      const totalArrowTime = (SEQ.length - 1) * STEP_MS;

      timers.push(setTimeout(() => {
        cheatImg.classList.add("on");
      }, totalArrowTime + PAUSE_MS));
    }

    function closeCheat(){
      clearTimers();
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      document.body.classList.remove("cheat-open");
      resetCheat();
    }

    sunHitbox.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      openCheat();
    });

    overlay.addEventListener("click", () => closeCheat());
    window.addEventListener("resize", () => overlay.classList.contains("show") && fitStage());
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && overlay.classList.contains("show")) closeCheat();
    });

    // Build arrows once on load
    buildArrows();
  </script>
</body>
</html>
